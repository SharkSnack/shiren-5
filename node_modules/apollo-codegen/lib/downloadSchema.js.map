{"version":3,"sources":["../src/downloadSchema.js"],"names":["defaultHeaders","url","outputPath","additionalHeaders","insecure","headers","agent","Agent","rejectUnauthorized","result","method","body","response","json","message","errors","schemaData","data","writeFileSync","downloadSchema"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;AAMA;;;;AAbA;;AAeA,IAAMA,iBAAiB;AACrB,YAAU,kBADW;AAErB,kBAAgB;AAFK,CAAvB;;;wEAKe,iBAA8BC,GAA9B,EAAmCC,UAAnC,EAA+CC,iBAA/C,EAAkEC,QAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AACPC,mBADO,GACG,sBAAcL,cAAd,EAA8BG,iBAA9B,CADH;AAEPG,iBAFO,GAECF,WAAW,IAAI,gBAAMG,KAAV,CAAgB,EAAEC,oBAAoB,KAAtB,EAAhB,CAAX,GAA4D,IAF7D;AAITC,kBAJS;AAAA;AAAA;AAAA,mBAMY,yBAAMR,GAAN,EAAW;AAChCS,sBAAQ,MADwB;AAEhCL,uBAASA,OAFuB;AAGhCM,oBAAM,yBAAe,EAAE,sCAAF,EAAf,CAH0B;AAIhCL;AAJgC,aAAX,CANZ;;AAAA;AAMLM,oBANK;AAAA;AAAA,mBAaIA,SAASC,IAAT,EAbJ;;AAAA;AAaXJ,kBAbW;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,kBAeL,sBAAe,oDAAmD,YAAMK,OAAQ,EAAhF,CAfK;;AAAA;AAAA,iBAkBTL,OAAOM,MAlBE;AAAA;AAAA;AAAA;;AAAA,kBAmBL,sBAAe,yCAAwCN,OAAOM,MAAO,EAArE,CAnBK;;AAAA;AAsBPC,sBAtBO,GAsBMP,MAtBN;;AAAA,gBAuBRO,WAAWC,IAvBH;AAAA;AAAA;AAAA;;AAAA,kBAwBL,sBAAe,oEAAmE,yBAAeR,MAAf,CAAuB,EAAzG,CAxBK;;AAAA;;AA2Bb,yBAAGS,aAAH,CAAiBhB,UAAjB,EAA6B,yBAAec,UAAf,EAA2B,IAA3B,EAAiC,CAAjC,CAA7B;;AA3Ba;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;WAAeG,c;;;;SAAAA,c","file":"downloadSchema.js","sourcesContent":["// Based on https://facebook.github.io/relay/docs/guides-babel-plugin.html#using-other-graphql-implementations\n\nimport fetch from 'node-fetch';\nimport fs from 'fs';\nimport path from 'path';\nimport https from 'https';\n\nimport {\n  buildClientSchema,\n  introspectionQuery,\n  printSchema,\n} from 'graphql/utilities';\n\nimport { ToolError } from './errors'\n\nconst defaultHeaders = {\n  'Accept': 'application/json',\n  'Content-Type': 'application/json'\n};\n\nexport default async function downloadSchema(url, outputPath, additionalHeaders, insecure) {\n  const headers = Object.assign(defaultHeaders, additionalHeaders);\n  const agent = insecure ? new https.Agent({ rejectUnauthorized: false }) : null;\n\n  let result;\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: headers,\n      body: JSON.stringify({ 'query': introspectionQuery }),\n      agent,\n    });\n\n    result = await response.json();\n  } catch (error) {\n    throw new ToolError(`Error while fetching introspection query result: ${error.message}`);\n  }\n\n  if (result.errors) {\n    throw new ToolError(`Errors in introspection query result: ${result.errors}`);\n  }\n\n  const schemaData = result;\n  if (!schemaData.data) {\n    throw new ToolError(`No introspection query result data found, server responded with: ${JSON.stringify(result)}`);\n  }\n\n  fs.writeFileSync(outputPath, JSON.stringify(schemaData, null, 2));\n}\n"]}